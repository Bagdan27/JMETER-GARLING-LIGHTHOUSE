gatling {

  # Куда писать данные
  data {
    writers = [console, file, graphite]   # graphite = канал в InfluxDB

    graphite {
      host = "localhost"          # IP машины где крутится InfluxDB
      port = 2003                 # Graphite-протокол (нужно включить в influxdb.conf)
      protocol = "tcp"
      rootPathPrefix = "gatling"  # Префикс всех метрик в InfluxDB
      bufferSize = 8192
      writePeriod = 1             # Отправка каждую 1 секунду — видим динамику в Grafana
    }
  }

  # Настройки движка симуляции
  core {
    encoding = "utf-8"
    elFileBodiesCache = true
    rawFileBodiesCache = true

    # Лимиты для виртуальных пользователей
    extract {
      regex {
        cacheMaxCapacity = 200
      }
      xpath {
        cacheMaxCapacity = 200
      }
      jsonPath {
        cacheMaxCapacity = 200
      }
      css {
        cacheMaxCapacity = 200
      }
    }
  }

  # HTTP настройки
  http {
    fetchedCssCacheMaxCapacity = 200
    fetchedHtmlCacheMaxCapacity = 200
    perUserCacheMaxCapacity = 200
    warmUpUrl = "http://localhost"   # Прогрев перед тестом

    # Таймауты
    requestTimeout = 60000           # 60 сек макс на запрос
    
    pooledConnectionIdleTimeout = 60000
    enableGA = false                 # Отключить Google Analytics пинги
  }

  # Отчёты
  charting {
    maxPlotPerSeries = 1000
    useGroupDurationMetric = false
    indicators {
      lowerBound = 800       # Зелёная зона: < 800ms
      higherBound = 1200     # Жёлтая зона: 800-1200ms, выше — красная
      percentile1 = 50
      percentile2 = 75
      percentile3 = 95
      percentile4 = 99
    }
  }
}
